<!DOCTYPE html>
<html>
<head>
    <title>MESE-Next</title>
    <meta charset='utf-8' />
</head>
<body>
    <div id='login'>
        <p>Name: <input id='login_name' type='text' /></p>
        <p>Password: <input id='login_password' type='password' /></p>
        <p><input id='login_go' type='submit' value='Go!' /></p>
    </div>
    <div id='user' style='display: none'>
        <p>Login user: <span id='user_name'></span></p>
        <hr>
        <p>Password: <input id='user_password' type='password' /></p>
        <p>New password: <input id='user_new_password' type='password' /></p>
        <p><input id='user_change_password' type='submit' value='Change password' /></p>
    </div>
    <div id='list'></div>
    <div id='game'></div>

    <script src='http://code.jquery.com/jquery-1.11.3.min.js'></script>
    <script src='/socket.io/socket.io.js'></script>
    <script>
        'use strict';

        var socket = io(window.location.origin);

        // login

        $('#login_name').keypress(function (event) {
            if (event.which === 13) {
                $('#login_password').focus();
            }
        });

        $('#login_password').keypress(function (event) {
            if (event.which === 13) {
                $('#login_go').click();
            }
        });

        $('#login_go').click(function () {
            var name = $('#login_name').val();
            var password = $('#login_password').val();
            $('#login_password').val('');

            socket.emit('login', {
                name: name,
                password: password, // TODO: hash?
            });

            socket.on('login_new', function (data) {
                $('#user_name').text(name + ' (new user)');
                $('#user').css('display', 'block');
            });

            socket.on('login_ok', function (data) {
                $('#user_name').text(name);
                $('#user').css('display', 'block');
            });

            socket.on('login_fail', function (data) {
                // TODO
                console.log('Wrong password!');
            });
        });

        // user

        $('#user_password').keypress(function (event) {
            if (event.which === 13) {
                $('#user_new_password').focus();
            }
        });

        $('#user_new_password').keypress(function (event) {
            if (event.which === 13) {
                $('#user_change_password').click();
            }
        });

        $('#user_change_password').click(function () {
            var password = $('#user_password').val();
            var newPassword = $('#user_new_password').val();
            $('#user_password').val('');
            $('#user_new_password').val('');

            socket.emit('password', {
                password: password, // TODO: hash?
                newPassword: newPassword, // TODO: hash?
            });

            socket.on('password_ok', function (data) {
                // TODO
                console.log('Password changed!');
            });

            socket.on('password_fail', function (data) {
                // TODO
                console.log('Wrong password!');
            });
        });





        // socket.on('login_new', function (data) {
        //     document.writeln('login_new<br>');
        // });

        // socket.on('login_ok', function (data) {
        //     //document.writeln('login_ok<br>');

        //     // socket.emit('list', {
        //     // });
        //     socket.emit('subscribe', {
        //         game: 'test',
        //         enabled: true,
        //     });

        //     // socket.emit('submit', {
        //     //     game: 'test',
        //     //     price: 70,
        //     //     prod: 500,
        //     //     mk: 3000,
        //     //     ci: 10000,
        //     //     rd: 5000,
        //     // });
        //     // socket.emit('report', {
        //     //     game: 'test',
        //     // });
        // });

        // socket.on('login_fail', function (data) {
        //     document.writeln('login_fail<br>');
        // });

        // socket.on('submit_ok', function (data) {
        //     // document.writeln(JSON.stringify(data));
        // });

        // socket.on('submit_decline', function (data) {
        //     // document.writeln(JSON.stringify(data));
        // });

        // socket.on('subscribe_list', function (data) {
        //     document.writeln(JSON.stringify(data));
        // });

        // socket.on('subscribe_update', function (data) {
        //     document.writeln(JSON.stringify(data));
        // });

        // socket.on('report_early', function (data) {
        //     document.writeln(JSON.stringify(data));
        // });

        // socket.on('report_player', function (data) {
        //     document.writeln(JSON.stringify(data));
        // });

        // socket.on('report_public', function (data) {
        //     document.writeln(JSON.stringify(data));
        // });

        // socket.on('submit_fail', function (data) {
        //     document.writeln('submit_fail<br>');
        // });
</script>
</body>
</html>